!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){var i;window,i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(1);t.Game=i.default;var o=n(5);t.Scene=o.Scene;var s=n(6);t.Entity=s.default;var r=n(7);t.Component=r.Component,t.Position=r.Position,t.Velocity=r.Velocity,t.Sprite=r.Sprite,t.AnimatedSprite=r.AnimatedSprite,t.Box=r.Box,t.InputMapping=r.InputMapping,t.Label=r.Label;var a=n(8);t.InputMappingSystem=a.InputMappingSystem},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),o=n(3),s=n(4),r=function(){function e(e){this.canvasContext=e,e.imageSmoothingEnabled=!1,this.services={input:new i.default,audio:new o.default,assets:new s.default,game:{switchToScene:this.switchToScene.bind(this)}},this.gameScenes={},this.currentScene=null,this.fps=60,this.then=Date.now(),console.log("Game object created")}return e.prototype.startRendering=function(e){this.fps=e||60,this.startSystem()},e.prototype.addScene=function(e){this.gameScenes[e.sceneId]=e,this.gameScenes[e.sceneId].assets=this.services.assets,null==this.currentScene&&this.switchToScene(e.sceneId)},e.prototype.switchToScene=function(e){null!=this.gameScenes[e]?(this.currentScene=this.gameScenes[e],this.currentScene.initialized&&!this.currentScene.alwaysInitialize||this.currentScene.initCallback(this.currentScene,this.services)):console.error("Scene doesn't exist: "+e)},e.prototype.setDebugMode=function(t){e.prototype.debugMode=t},e.prototype.getDebugMode=function(){return e.prototype.debugMode},e.prototype.log=function(t){e.prototype.debugMode&&console.log(t)},e.prototype.startSystem=function(){var e=this;if(window.requestAnimationFrame(function(){e.startSystem()}),this.interval=1e3/this.fps,this.now=Date.now(),this.delta=this.now-this.then,this.delta>this.interval){if(this.then=this.now-this.delta%this.interval,!this.currentScene)return;for(var t in this.currentScene.gameEntities)for(var n in this.currentScene.systems){var i=this.currentScene.gameEntities[t],o=this.currentScene.systems[n];i.hasComponents(o.requiredComponents)&&this.currentScene.systems[n].update(i,this.services)}var s;for(var t in this.canvasContext.fillStyle="white",this.canvasContext.fillRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height),this.currentScene.gameEntities)if((s=this.currentScene.gameEntities[t]).hasComponent("Box")&&s.hasComponent("Position")&&(this.canvasContext.fillStyle=s.Box.fillStyle,this.canvasContext.fillRect(s.Position.x,s.Position.y,s.Box.width,s.Box.height)),s.hasComponent("Label")&&s.hasComponent("Position")&&(this.canvasContext.fillStyle=s.Label.color,this.canvasContext.fillText(s.Label.txt,s.Position.x,s.Position.y)),s.hasComponent("Sprite")&&s.hasComponent("Position")&&this.canvasContext.drawImage(s.Sprite.spriteSource,s.Position.x,s.Position.y),s.hasComponents(["AnimatedSprite","Position"])){var r=s.AnimatedSprite,a=r.animationSheet[r.animationName];r.flip&&(this.canvasContext.translate(s.Position.x,0),this.canvasContext.scale(-1,1)),this.canvasContext.drawImage(r.spriteSource,a.startX+r.currentFrame*a.frameWidth,a.startY,a.frameWidth,a.frameHeight,r.flip?-r.scale*a.frameWidth:s.Position.x,s.Position.y,a.frameWidth*r.scale,a.frameHeight*r.scale),r.flip&&this.canvasContext.setTransform(1,0,0,1,0,0),r.isPlaying&&(r.currentFrame>=a.frames-1?r.currentFrame=0:r.currentFrame++)}}},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){var e=this;this.pressedKeys=[],window.addEventListener("keydown",function(t){-1===e.pressedKeys.indexOf(t.keyCode)&&e.pressedKeys.push(t.keyCode)},!1),window.addEventListener("keyup",function(t){e.pressedKeys.splice(e.pressedKeys.indexOf(t.keyCode),1)},!1)}return e.prototype.isPressed=function(e){return-1!==this.pressedKeys.indexOf(e)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.songsPlaying=[],this.masterVolume=this.audioContext.createGain(),this.musicVolume=this.audioContext.createGain(),this.musicVolume.connect(this.masterVolume),this.effectsVolume=this.audioContext.createGain(),this.effectsVolume.connect(this.masterVolume),this.masterVolume.connect(this.audioContext.destination)}catch(e){console.error(e)}}return e.prototype.setBackgroundMusic=function(e,t){if(-1==this.songsPlaying.indexOf(e)){var n=this,i=this.audioContext.createBufferSource();i.buffer=e,i.loop=t||!1,i.connect(this.musicVolume),i.start(),i.onended=function(){t||n.songsPlaying.splice(n.songsPlaying.indexOf(e),1)},this.songsPlaying.push(e)}},e.prototype.playSound=function(e,t){var n=this.audioContext.createBufferSource();n.buffer=e,n.loop=t||!1,n.connect(this.effectsVolume),n.start()},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.completionCallback=e||function(){},this.loadCounter=0,this.readyCounter=0,this.assets={},this.audio=new(window.AudioContext||window.webkitAudioContext),this.imageTypes=[".png",".jpg",".gif"],this.objectTypes=[".txt","json"],this.audioTypes=[".wav",".mp3",".ogg"]}return e.prototype.addImageTask=function(e,t){var n=this,i=new Image;i.src=e,i.onload=function(){n.readyCounter++,n.attemptCompletionCallback(n.completionCallback)},this.assets[this.deriveObjectName(e,t)]=i,this.loadCounter++},e.prototype.addHttpTask=function(e,t){var n=new XMLHttpRequest,i=this;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(i.assets[i.deriveObjectName(e,t)]=JSON.parse(n.responseText),i.readyCounter++,i.attemptCompletionCallback(i.completionCallback))},n.overrideMimeType("application/json"),n.open("GET",e,!0),n.send(null),this.loadCounter++},e.prototype.addBufferTask=function(e,t){var n=this,i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",e,!0),i.onload=function(){n.audio.decodeAudioData(i.response,function(i){n.assets[n.deriveObjectName(e,t)]=i,n.readyCounter++,n.attemptCompletionCallback(n.completionCallback)},function(){console.log("Error decoding audio")})},i.send(),this.loadCounter++},e.prototype.addTaskList=function(e){var t=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status)for(var e=n.responseText.split("\n"),i=0;i<e.length;i++){var o=-1==e[i].indexOf("\r")?e[i].slice(-4):e[i].slice(-5).slice(0,-1);-1!=t.imageTypes.indexOf(o)&&t.addImageTask(e[i]),-1!=t.objectTypes.indexOf(o)&&t.addHttpTask(e[i]),-1!=t.audioTypes.indexOf(o)&&t.addBufferTask(e[i])}},n.overrideMimeType("application/json"),n.open("GET",e,!0),n.send(null)},e.prototype.isReady=function(){return 0!=this.loadCounter&&this.readyCounter==this.loadCounter},e.prototype.getProgress=function(){return 0!=this.loadCounter?this.readyCounter/this.loadCounter*100:0},e.prototype.getAsset=function(e){return this.assets[e]},e.prototype.attemptCompletionCallback=function(e){this.readyCounter==this.loadCounter&&void 0!==e&&e()},e.prototype.deriveObjectName=function(e,t){if(void 0===t){var n=e.slice(e.lastIndexOf("/")+1);return n.slice(0,n.indexOf("."))}return t},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.sceneId=e.sceneId,this.initialized=!1,this.alwaysInitialize=e.alwaysInitialize||!0,this.initCallback=e.init,this.gameEntities={},this.systems={}}return e.prototype.registerSystem=function(e){this.systems[e.systemId]=e},e.prototype.unregisterSystem=function(e){delete this.systems[e.systemId]},e.prototype.addEntity=function(e){this.gameEntities[e.id]=e},e}();t.Scene=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.id=e.prototype.count,e.prototype.count++}return e.prototype.addComponent=function(e){this[e.name]=e},e.prototype.removeComponent=function(e){delete this[e]},e.prototype.hasComponent=function(e){return null!=this[e]},e.prototype.hasComponents=function(e){for(var t=e.length,n=0;n<t;n++)if(!this.hasComponent(e[n]))return!1;return!0},e}();t.default=i,i.prototype.count=0},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=function(){return function(e){this.name=e}}();t.Component=s;var r=function(e){function t(t,n){var i=e.call(this,"Position")||this;return i.x=t,i.y=n,i}return o(t,e),t}(s);t.Position=r;var a=function(e){function t(t,n){var i=e.call(this,"Velocity")||this;return i.x=t,i.y=n,i}return o(t,e),t}(s);t.Velocity=a;var u=function(e){function t(t,n){var i=e.call(this,"Label")||this;return i.txt=t,i.color=n.color||"#000",i.font=n.font||"monospace",i.isVisible=n.isVisible||!0,i}return o(t,e),t}(s);t.Label=u;var c=function(e){function t(t){var n=e.call(this,"Sprite")||this;return n.spriteSource=t,n}return o(t,e),t}(s);t.Sprite=c;var p=function(e){function t(t,n,i){var o=e.call(this,"AnimatedSprite")||this;if(o.spriteSource=t,o.animationSheet=n,void 0===i)i={};return o.animationName=i.animationName||Object.keys(n)[0],o.scale=i.scale||1,o.loop=i.loop||!0,o.isPlaying=i.isPlaying||!0,o.flip=i.flip||!1,o.currentFrame=0,o}return o(t,e),t}(s);t.AnimatedSprite=p;var l=function(e){function t(t){var n=e.call(this,"AudioSource")||this;return n.audioBuffer=t,n}return o(t,e),t}(s);t.AudioSource=l;var d=function(e){function t(t,n,i){var o=e.call(this,"Box")||this;return o.width=t,o.height=n,o.fillStyle=i,o}return o(t,e),t}(s);t.Box=d;var f=function(e){function t(t,n){var i=e.call(this,"BoxCollider")||this;return i.width=t,i.height=n,i}return o(t,e),t}(s);t.BoxCollider=f;var h=function(e){function t(t){var n=e.call(this,"InputMapping")||this;n.mapping=t;for(var i=0;i<t.length;i++)n[t[i].name]=!1;return n}return o(t,e),t}(s);t.InputMapping=h},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Local=0]="Local",e[e.Global=1]="Global"}(t.SystemScope||(t.SystemScope={})),function(e){e[e.NonRender=0]="NonRender",e[e.Render=1]="Render"}(i=t.SystemType||(t.SystemType={})),t.InputMappingSystem={systemId:"inputMappingSystem",type:i.NonRender,requiredComponents:["InputMapping"],update:function(e,t){for(var n=e.InputMapping,i=0;i<n.mapping.length;i++){var o=n.mapping[i];n[o.name]=t.input.isPressed(o.code)}}};i.Render}])},e.exports=i()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(0),s=n(2),r=n(3),a=document.getElementById("canvas");(i=a).width=window.innerWidth,i.height=window.innerHeight;var u=new o.Game(a.getContext("2d"));u.addScene(new o.Scene(s.loading)),u.addScene(new o.Scene(r.ingame)),u.startRendering(20)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.loading={sceneId:"loading",alwaysInitialize:!1,init:function(e,t){e.registerSystem(i.InputMappingSystem),e.registerSystem({systemId:"labelSystem",requiredComponents:["InputMapping","Label"],update:function(e,t){var n=e.Label,i=e.InputMapping;t.assets.isReady()&&(n.isVisible=!0,t.assets.isReady()&&i.proceed&&t.game.switchToScene("ingame"))}});var n=new i.Entity;n.addComponent(new i.InputMapping([{name:"proceed",code:13}])),n.addComponent(new i.Label("Loading complete. Press Enter to proceed",{isVisible:!1,color:"#000",font:"Arial"})),n.addComponent(new i.Position(10,10)),e.addEntity(n),t.assets.addTaskList("assets/asset_list.txt")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.ingame={sceneId:"ingame",alwaysInitialize:!0,init:function(e,t){e.registerSystem(i.InputMappingSystem),e.registerSystem(o);var n=t.assets.getAsset("img_bg"),s=new i.Entity;s.addComponent(new i.Position(-150,-300)),s.addComponent(new i.Sprite(n)),e.addEntity(s);var r=t.assets.getAsset("80x48Wolf_FullSheet"),a=t.assets.getAsset("wolf_info"),u=new i.Entity;u.addComponent(new i.Position(100,445)),u.addComponent(new i.InputMapping([{name:"right",code:39},{name:"left",code:37}])),u.addComponent(new i.AnimatedSprite(r,a,{animationName:"idle",isPlaying:!0,loop:!0,scale:5})),e.addEntity(u)}};var o={systemId:"wolfMovementSystem",requiredComponents:["AnimatedSprite","Position","InputMapping"],update:function(e,t){var n=e.InputMapping,i=e.AnimatedSprite,o=e.Position;n.right?(i.animationName="running",i.flip=!1,o.x+=20):n.left?(i.animationName="running",i.flip=!0,o.x-=20):i.animationName="idle"}}}]);
//# sourceMappingURL=bundle.js.map