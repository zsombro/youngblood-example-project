!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){var i;window,i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.sceneId=e.sceneId,this.initialized=!1,this.alwaysInitialize=e.alwaysInitialize||!0,this.initCallback=e.init,this.gameEntities={},this.systems={}}return e.prototype.registerSystem=function(e){this.systems[e.systemId]=e},e.prototype.unregisterSystem=function(e){delete this.systems[e.systemId]},e.prototype.addEntity=function(e){this.gameEntities[e.id]=e},e}();t.Scene=i},function(e,t,n){"use strict";var i,o=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e){this.name=e}}();t.default=r;var s=function(e){function t(t,n){var i=e.call(this,"Position")||this;return i.x=t,i.y=n,i}return o(t,e),t}(r);t.Position=s;var a=function(e){function t(t,n){var i=e.call(this,"Velocity")||this;return i.x=t,i.y=n,i}return o(t,e),t}(r);t.Velocity=a;var u=function(e){function t(t,n){var i=e.call(this,"Label")||this;return i.txt=t,i.color=n.color||"#000",i.font=n.font||"monospace",i.isVisible=n.isVisible||!0,i}return o(t,e),t}(r);t.Label=u;var c=function(e){function t(t){var n=e.call(this,"Sprite")||this;return n.spriteSource=t,n}return o(t,e),t}(r);t.Sprite=c;var d=function(e){function t(t,n,i){var o=e.call(this,"AnimatedSprite")||this;if(o.spriteSource=t,o.animationSheet=n,void 0===i)i={};return o.animationName=i.animationName||Object.keys(n)[0],o.scale=i.scale||1,o.loop=i.loop||!0,o.isPlaying=i.isPlaying||!0,o.flip=i.flip||!1,o.currentFrame=0,o}return o(t,e),t}(r);t.AnimatedSprite=d;var l=function(e){function t(t){var n=e.call(this,"AudioSource")||this;return n.audioBuffer=t,n}return o(t,e),t}(r);t.AudioSource=l;var p=function(e){function t(t,n,i){var o=e.call(this,"Box")||this;return o.width=t,o.height=n,o.fillStyle=i,o}return o(t,e),t}(r);t.Box=p;var f=function(e){function t(t,n){var i=e.call(this,"BoxCollider")||this;return i.width=t,i.height=n,i}return o(t,e),t}(r);t.BoxCollider=f;var h=function(e){function t(t){var n=e.call(this,"InputMapping")||this;n.mapping=t;for(var i=0;i<t.length;i++)n[t[i].name]=!1;return n}return o(t,e),t}(r);t.InputMapping=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(3);t.Game=i.default;var o=n(0);t.Scene=o.Scene;var r=n(8);t.Entity=r.default;var s=n(1);t.Position=s.Position,t.Velocity=s.Velocity,t.Sprite=s.Sprite,t.AnimatedSprite=s.AnimatedSprite,t.Box=s.Box,t.InputMapping=s.InputMapping,t.Label=s.Label;var a=n(1);t.Component=a.default;var u=n(9);t.InputMappingSystem=u.InputMappingSystem},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),o=n(4),r=n(5),s=n(6),a=n(7),u=function(){function e(){this.renderer=null,this.services={input:new o.default,audio:new r.default,assets:new s.default,game:{switchToScene:this.switchToScene.bind(this)}},this.gameScenes={},this.currentScene=null,this.fps=60,this.then=Date.now(),console.info("Game created")}return e.prototype.startRendering=function(e){if(void 0===e&&(e="canvas"),!this.renderer){var t=document.querySelector(e).getContext("2d");t.imageSmoothingEnabled=!1,this.setRenderer(a.default(t))}this.startSystem(),console.info("Started rendering at "+this.fps+"fps")},e.prototype.setFramerate=function(e){return this.fps=e,this},e.prototype.setRenderer=function(e){return this.renderer=e,this},e.prototype.addScene=function(e){return this.gameScenes[e.sceneId]=new i.Scene(e),this.gameScenes[e.sceneId].assets=this.services.assets,null==this.currentScene&&this.switchToScene(e.sceneId),console.info("Scene added: "+e.sceneId),this},e.prototype.switchToScene=function(e){if(null!=this.gameScenes[e])return this.currentScene=this.gameScenes[e],this.currentScene.initialized&&!this.currentScene.alwaysInitialize||this.currentScene.initCallback(this.currentScene,this.services),this;console.error("Scene doesn't exist: "+e)},e.prototype.startSystem=function(){var e=this;if(window.requestAnimationFrame(function(){e.startSystem()}),this.interval=1e3/this.fps,this.now=Date.now(),this.delta=this.now-this.then,this.delta>this.interval){if(this.then=this.now-this.delta%this.interval,!this.currentScene)return;for(var t in this.currentScene.gameEntities)for(var n in this.currentScene.systems){var i=this.currentScene.gameEntities[t],o=this.currentScene.systems[n];i.hasComponents(o.requiredComponents)&&this.currentScene.systems[n].update(i,this.services)}this.renderer(this.currentScene)}},e}();t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){var e=this;this.pressedKeys=[],window.addEventListener("keydown",function(t){-1===e.pressedKeys.indexOf(t.keyCode)&&e.pressedKeys.push(t.keyCode)},!1),window.addEventListener("keyup",function(t){e.pressedKeys.splice(e.pressedKeys.indexOf(t.keyCode),1)},!1)}return e.prototype.isPressed=function(e){return-1!==this.pressedKeys.indexOf(e)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.songsPlaying=[],this.masterVolume=this.audioContext.createGain(),this.musicVolume=this.audioContext.createGain(),this.musicVolume.connect(this.masterVolume),this.effectsVolume=this.audioContext.createGain(),this.effectsVolume.connect(this.masterVolume),this.masterVolume.connect(this.audioContext.destination)}catch(e){console.error(e)}}return e.prototype.setBackgroundMusic=function(e,t){if(-1==this.songsPlaying.indexOf(e)){var n=this,i=this.audioContext.createBufferSource();i.buffer=e,i.loop=t||!1,i.connect(this.musicVolume),i.start(),i.onended=function(){t||n.songsPlaying.splice(n.songsPlaying.indexOf(e),1)},this.songsPlaying.push(e)}},e.prototype.playSound=function(e,t){var n=this.audioContext.createBufferSource();n.buffer=e,n.loop=t||!1,n.connect(this.effectsVolume),n.start()},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.completionCallback=e||function(){},this.loadCounter=0,this.readyCounter=0,this.assets={},this.audio=new(window.AudioContext||window.webkitAudioContext),this.imageTypes=[".png",".jpg",".gif"],this.objectTypes=[".txt","json"],this.audioTypes=[".wav",".mp3",".ogg"]}return e.prototype.addImageTask=function(e,t){var n=this,i=new Image;i.src=e,i.onload=function(){n.readyCounter++,n.attemptCompletionCallback(n.completionCallback)},this.assets[this.deriveObjectName(e,t)]=i,this.loadCounter++},e.prototype.addHttpTask=function(e,t){var n=new XMLHttpRequest,i=this;n.onreadystatechange=function(){4==n.readyState&&200==n.status&&(i.assets[i.deriveObjectName(e,t)]=JSON.parse(n.responseText),i.readyCounter++,i.attemptCompletionCallback(i.completionCallback))},n.overrideMimeType("application/json"),n.open("GET",e,!0),n.send(null),this.loadCounter++},e.prototype.addBufferTask=function(e,t){var n=this,i=new XMLHttpRequest;i.responseType="arraybuffer",i.open("GET",e,!0),i.onload=function(){n.audio.decodeAudioData(i.response,function(i){n.assets[n.deriveObjectName(e,t)]=i,n.readyCounter++,n.attemptCompletionCallback(n.completionCallback)},function(){console.error("Error decoding audio")})},i.send(),this.loadCounter++},e.prototype.addTaskList=function(e){var t=this,n=new XMLHttpRequest;n.onreadystatechange=function(){if(4==n.readyState&&200==n.status)for(var e=n.responseText.split("\n"),i=0;i<e.length;i++){var o=-1==e[i].indexOf("\r")?e[i].slice(-4):e[i].slice(-5).slice(0,-1);-1!=t.imageTypes.indexOf(o)&&t.addImageTask(e[i]),-1!=t.objectTypes.indexOf(o)&&t.addHttpTask(e[i]),-1!=t.audioTypes.indexOf(o)&&t.addBufferTask(e[i])}},n.overrideMimeType("application/json"),n.open("GET",e,!0),n.send(null)},e.prototype.isReady=function(){return 0!=this.loadCounter&&this.readyCounter==this.loadCounter},e.prototype.getProgress=function(){return 0!=this.loadCounter?this.readyCounter/this.loadCounter*100:0},e.prototype.getAsset=function(e){return this.assets[e]},e.prototype.attemptCompletionCallback=function(e){this.readyCounter==this.loadCounter&&void 0!==e&&e()},e.prototype.deriveObjectName=function(e,t){if(void 0===t){var n=e.slice(e.lastIndexOf("/")+1);return n.slice(0,n.indexOf("."))}return t},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t){var n;for(var i in e.fillStyle="white",e.fillRect(0,0,e.canvas.width,e.canvas.height),t.gameEntities)if((n=t.gameEntities[i]).hasComponent("Box")&&n.hasComponent("Position")&&(e.fillStyle=n.Box.fillStyle,e.fillRect(n.Position.x,n.Position.y,n.Box.width,n.Box.height)),n.hasComponent("Label")&&n.hasComponent("Position")&&(e.fillStyle=n.Label.color,e.fillText(n.Label.txt,n.Position.x,n.Position.y)),n.hasComponent("Sprite")&&n.hasComponent("Position")&&e.drawImage(n.Sprite.spriteSource,n.Position.x,n.Position.y),n.hasComponents(["AnimatedSprite","Position"])){var o=n.AnimatedSprite,r=o.animationSheet[o.animationName];o.flip&&(e.translate(n.Position.x,0),e.scale(-1,1)),e.drawImage(o.spriteSource,r.startX+o.currentFrame*r.frameWidth,r.startY,r.frameWidth,r.frameHeight,o.flip?-o.scale*r.frameWidth:n.Position.x,n.Position.y,r.frameWidth*o.scale,r.frameHeight*o.scale),o.flip&&e.setTransform(1,0,0,1,0,0),o.isPlaying&&(o.currentFrame>=r.frames-1?o.currentFrame=0:o.currentFrame++)}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.id=e.prototype.count,e.prototype.count++}return e.prototype.addComponent=function(e){this[e.name]=e},e.prototype.removeComponent=function(e){delete this[e]},e.prototype.hasComponent=function(e){return null!=this[e]},e.prototype.hasComponents=function(e){for(var t=e.length,n=0;n<t;n++)if(!this.hasComponent(e[n]))return!1;return!0},e.prototype.get=function(e){switch(e){case"Velocity":case"Position":case"Sprite":case"AnimatedSprite":case"InputMapping":default:return this[e]}},e}();t.default=i,i.prototype.count=0},function(e,t,n){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Local=0]="Local",e[e.Global=1]="Global"}(t.SystemScope||(t.SystemScope={})),function(e){e[e.NonRender=0]="NonRender",e[e.Render=1]="Render"}(i=t.SystemType||(t.SystemType={})),t.InputMappingSystem={systemId:"inputMappingSystem",type:i.NonRender,requiredComponents:["InputMapping"],update:function(e,t){for(var n=e.InputMapping,i=0;i<n.mapping.length;i++){var o=n.mapping[i];n[o.name]=t.input.isPressed(o.code)}}};i.Render}])},e.exports=i()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(0),r=n(2),s=n(3);(i=document.querySelector("canvas"))&&(i.width=window.innerWidth,i.height=window.innerHeight),(new o.Game).addScene(r.loading).addScene(s.ingame).setFramerate(20).startRendering()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.loading={sceneId:"loading",alwaysInitialize:!1,init:function(e,t){e.registerSystem(i.InputMappingSystem),e.registerSystem({systemId:"labelSystem",requiredComponents:["InputMapping","Label"],update:function(e,t){var n=e.Label,i=e.InputMapping;t.assets.isReady()&&(n.isVisible=!0,t.assets.isReady()&&i.proceed&&t.game.switchToScene("ingame"))}});var n=new i.Entity;n.addComponent(new i.InputMapping([{name:"proceed",code:13}])),n.addComponent(new i.Label("Loading complete. Press Enter to proceed",{isVisible:!1,color:"#000",font:"Arial"})),n.addComponent(new i.Position(10,10)),e.addEntity(n),t.assets.addTaskList("assets/asset_list.txt")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.ingame={sceneId:"ingame",alwaysInitialize:!0,init:function(e,t){e.registerSystem(i.InputMappingSystem),e.registerSystem(o);var n=t.assets.getAsset("img_bg"),r=new i.Entity;r.addComponent(new i.Position(-150,-300)),r.addComponent(new i.Sprite(n)),e.addEntity(r);var s=t.assets.getAsset("80x48Wolf_FullSheet"),a=t.assets.getAsset("wolf_info"),u=new i.Entity;u.addComponent(new i.Position(100,445)),u.addComponent(new i.InputMapping([{name:"right",code:39},{name:"left",code:37}])),u.addComponent(new i.AnimatedSprite(s,a,{animationName:"idle",isPlaying:!0,loop:!0,scale:5})),e.addEntity(u)}};var o={systemId:"wolfMovementSystem",requiredComponents:["AnimatedSprite","Position","InputMapping"],update:function(e,t){var n=e.get("AnimatedSprite"),i=e.get("Position"),o=e.get("InputMapping");o.right?(n.animationName="running",n.flip=!1,i.x+=20):o.left?(n.animationName="running",n.flip=!0,i.x-=20):n.animationName="idle"}}}]);
//# sourceMappingURL=bundle.js.map